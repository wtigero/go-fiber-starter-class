# ⚡ Google Wire (Code Generation DI)

## 🎯 วัตถุประสงค์
เรียนรู้ **Google Wire** - Code Generation Dependency Injection ที่เร็วที่สุด

## 💡 หลักการ Google Wire

```go
//go:build wireinject
// +build wireinject

//go:generate wire
func InitializeUserController() *controller.UserController {
    wire.Build(
        repository.NewUserRepository,
        service.NewUserService,
        controller.NewUserController,
    )
    return nil // Wire จะ generate โค้ดจริงให้
}
```

## 🏗️ โครงสร้าง

```
03-google-wire/
├── models/
│   └── user.go           # Entity (เหมือนเดิม)
├── repository/
│   └── user_repository.go # Data layer
├── service/
│   └── user_service.go    # Business logic  
├── controller/
│   └── user_controller.go # HTTP handlers
├── wire.go               # ⚡ Wire injection setup
├── wire_gen.go           # 🤖 Auto-generated (ห้ามแก้)
├── main.go               # 🔌 Wire-generated DI
└── go.mod                # + wire dependency
```

## 🔄 Data Flow (Google Wire)

```
wire.go → wire generate → wire_gen.go → main.go ใช้ generated function
         ↓
    Wire ทำ:
    1. อ่าน wire.Build()
    2. สร้างโค้ด Go จริง
    3. เร็วเท่า manual constructor
```

## ⚡ Wire Setup

```go
// wire.go - นิยาม dependencies
//go:build wireinject

package main

import (
    "wire-di/controller"
    "wire-di/repository" 
    "wire-di/service"
    "github.com/google/wire"
)

//go:generate wire
func InitializeUserController() *controller.UserController {
    wire.Build(
        repository.NewUserRepository,
        service.NewUserService,
        controller.NewUserController,
    )
    return nil // Wire จะแทนที่
}
```

## ✅ ข้อดี Google Wire

- **⚡ Fastest**: เร็วเท่า Manual Constructor (ไม่มี reflection)
- **🛡️ Compile-time Safety**: ตรวจสอบ dependencies ตอน compile
- **🤖 Auto-generation**: สร้างโค้ดให้อัตโนมัติ
- **🧹 Clean**: โค้ดที่ generate สะอาด อ่านง่าย
- **🔍 Transparent**: เห็นโค้ดจริงที่ถูกสร้าง

## ❌ ข้อเสีย

- **🔧 Complex Setup**: ต้อง generate โค้ดทุกครั้งที่เปลี่ยน
- **📚 Learning Curve**: ต้องเข้าใจ build tags และ generation
- **🔄 Workflow**: ต้อง run `go generate` หลังแก้ไข dependencies

## 🛠️ การ Setup

```bash
# 1. ติดตั้ง Wire
go install github.com/google/wire/cmd/wire@latest

# 2. สร้าง wire.go
# 3. Generate โค้ด
go generate ./...

# 4. รันแอป
go run main.go
```

## 🧪 การทดสอบ

```bash
# ติดตั้ง dependencies
go mod tidy

# Generate wire code
go generate ./...

# รันแอป
go run main.go

# ทดสอบ API
curl -X POST http://localhost:3000/users \
  -H "Content-Type: application/json" \
  -d '{"name":"Bob","email":"bob@example.com"}'

curl http://localhost:3000/users
```

## 📊 API Endpoints (เหมือนทุก pattern)

| Method | Endpoint     | Description |
|--------|-------------|-------------|
| GET    | /users      | ดึงผู้ใช้ทั้งหมด |
| POST   | /users      | สร้างผู้ใช้ใหม่ |
| GET    | /users/:id  | ดึงผู้ใช้ตาม ID |
| PUT    | /users/:id  | แก้ไขผู้ใช้ |
| DELETE | /users/:id  | ลบผู้ใช้ |

## 🔍 Generated Code (wire_gen.go)

Wire จะสร้างโค้ดแบบนี้ให้:

```go
// Code generated by Wire. DO NOT EDIT.

//go:generate go run github.com/google/wire/cmd/wire
//go:build !wireinject

package main

import (
    "wire-di/controller"
    "wire-di/repository"
    "wire-di/service"
)

func InitializeUserController() *controller.UserController {
    userRepository := repository.NewUserRepository()
    userService := service.NewUserService(userRepository)
    userController := controller.NewUserController(userService)
    return userController
}
```

## 🎯 เมื่อไหร่ควรใช้?

✅ **ใช้เมื่อ:**
- โปรเจคใหญ่ (50+ services)
- ต้องการ performance สูงสุด
- ทีม experienced กับ Go
- ต้องการ compile-time safety

❌ **ไม่ควรใช้เมื่อ:**
- โปรเจคเล็กๆ (< 10 services)
- ทีมไม่คุ้นชิน code generation
- Rapid prototyping

## 🔄 เปรียบเทียบทั้ง 3 แบบ

| Feature | Constructor | Uber Dig | Google Wire |
|---------|-------------|----------|-------------|
| **Performance** | ⭐⭐⭐⭐⭐ | ⭐⭐⭐ | ⭐⭐⭐⭐⭐ |
| **Setup** | ⭐⭐⭐⭐⭐ | ⭐⭐⭐ | ⭐⭐ |
| **Auto-wiring** | ❌ | ✅ | ✅ |
| **Compile Safety** | ✅ | ❌ | ✅ |
| **Learning** | ⭐⭐⭐⭐⭐ | ⭐⭐⭐ | ⭐⭐ |
| **Flexibility** | ⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐⭐ | 